// MyProject
//------------------------------------------------------------------------------

#define USING_VS2013
#define USING_QT5_9_1
//#define USING_VS2019
//#define USING_QT5_13_2

#define USING_PCH
#define USING_UNITY

//------------------------------------------------------------------------------
// Windows Platform
//------------------------------------------------------------------------------
#include "fbuild/VisualStudio/VisualStudio.bff"
#include "fbuild/Windows/Windows.bff"
#include "fbuild/Qt/Qt.bff"

//------------------------------------------------------------------------------
// Settings
//------------------------------------------------------------------------------
Settings
{
    #if __WINDOWS__
        #import TMP
#if USING_VS_2019
        .Environment    = { "PATH=$VS_PATH$;$WINSDK_PATH$",
                            "TMP=$TMP$",
                            "SystemRoot=C:\Windows",
                            "INCLUDE=C:\Program Files (x86)\Microsoft Visual Studio\2019\Community\VC\Tools\MSVC\14.23.28105\ATLMFC\include;C:\Program Files (x86)\Microsoft Visual Studio\2019\Community\VC\Tools\MSVC\14.23.28105\include;C:\Program Files (x86)\Windows Kits\NETFXSDK\4.8\include\um;C:\Program Files (x86)\Windows Kits\10\include\10.0.17763.0\ucrt;C:\Program Files (x86)\Windows Kits\10\include\10.0.17763.0\shared;C:\Program Files (x86)\Windows Kits\10\include\10.0.17763.0\um;C:\Program Files (x86)\Windows Kits\10\include\10.0.17763.0\winrt;C:\Program Files (x86)\Windows Kits\10\include\10.0.17763.0\cppwinrt",
                            "LIB=C:\Program Files (x86)\Microsoft Visual Studio\2019\Community\VC\Tools\MSVC\14.23.28105\ATLMFC\lib\x64;C:\Program Files (x86)\Microsoft Visual Studio\2019\Community\VC\Tools\MSVC\14.23.28105\lib\x64;C:\Program Files (x86)\Windows Kits\NETFXSDK\4.8\lib\um\x64;C:\Program Files (x86)\Windows Kits\10\lib\10.0.17763.0\ucrt\x64;C:\Program Files (x86)\Windows Kits\10\lib\10.0.17763.0\um\x64;",
                            "LIBPATH=C:\Program Files (x86)\Microsoft Visual Studio\2019\Community\VC\Tools\MSVC\14.23.28105\ATLMFC\lib\x64;C:\Program Files (x86)\Microsoft Visual Studio\2019\Community\VC\Tools\MSVC\14.23.28105\lib\x64;C:\Program Files (x86)\Microsoft Visual Studio\2019\Community\VC\Tools\MSVC\14.23.28105\lib\x86\store\references;C:\Program Files (x86)\Windows Kits\10\UnionMetadata\10.0.17763.0;C:\Program Files (x86)\Windows Kits\10\References\10.0.17763.0;C:\WINDOWS\Microsoft.NET\Framework64\v4.0.30319;"
                          }
#else
        .Environment    = { "PATH=$VS_PATH$;$WINSDK_PATH$",
                            "TMP=$TMP$",
                            "SystemRoot=C:\Windows",
                            "INCLUDE=C:\Program Files (x86)\Microsoft Visual Studio 12.0\VC\INCLUDE;C:\Program Files (x86)\Microsoft Visual Studio 12.0\VC\ATLMFC\INCLUDE;C:\Program Files (x86)\Windows Kits\8.1\include\shared;C:\Program Files (x86)\Windows Kits\8.1\include\um;C:\Program Files (x86)\Windows Kits\8.1\include\winrt;",
                            "LIB=C:\Program Files (x86)\Microsoft Visual Studio 12.0\VC\LIB\amd64;C:\Program Files (x86)\Microsoft Visual Studio 12.0\VC\ATLMFC\LIB\amd64;C:\Program Files (x86)\Windows Kits\8.1\lib\winv6.3\um\x64;",
                            "LIBPATH=C:\WINDOWS\Microsoft.NET\Framework64\v4.0.30319;C:\Program Files (x86)\Microsoft Visual Studio 12.0\VC\LIB\amd64;C:\Program Files (x86)\Microsoft Visual Studio 12.0\VC\ATLMFC\LIB\amd64;C:\Program Files (x86)\Windows Kits\8.1\References\CommonConfiguration\Neutral;C:\Program Files (x86)\Microsoft SDKs\Windows\v8.1\ExtensionSDKs\Microsoft.VCLibs\12.0\References\CommonConfiguration\neutral;"
                          }
#endif
        .CachePath      = "fbuild\.fbuild.cache"
    #else
        .CachePath      = "/tmp/.fbuild.cache"
    #endif
    .AllowDBMigration_Experimental = true
}

//------------------------------------------------------------------------------
// Config Defines
//------------------------------------------------------------------------------
.Debug_Config =
[
    .CompilerOptions                = ' -MDd'
                                    + ' -Z7'
    .PCHOptions                     = .CompilerOptions
    .LinkerOptions                  = ' /DEBUG'
                                    + ' msvcrtd.lib'
                                    + ' msvcprtd.lib'
                                    + ' vcompd.lib'     // OpenMP

    .Config                         = 'Debug'
]
.Profile_Config =
[
    .CompilerOptions                = ' -MD'
                                    + ' -Z7'
                                    + ' -O2'
                                    + ' -Zc:strictStrings'
                                    + ' -DNDEBUG'
    .PCHOptions                     = .CompilerOptions
    .LinkerOptions                  = ' /DEBUG /OPT:REF /INCREMENTAL:NO'
                                    + ' msvcrt.lib'
                                    + ' msvcprt.lib'
                                    + ' vcomp.lib'     // OpenMP

    .Config                         = 'Profile'
]
.Release_Config =
[
    .CompilerOptions                = ' -MD'
                                    + ' -O2'
                                    + ' -Zc:strictStrings'
                                    + ' -DNDEBUG'
    .PCHOptions                     = .CompilerOptions
    .LinkerOptions                  = ' /INCREMENTAL:NO'
                                    + ' /NODEFAULTLIB:LIBCMT'
                                    + ' msvcrt.lib'
                                    + ' msvcprt.lib'
                                    + ' vcomp.lib'     // OpenMP

    .Config                         = 'Release'
]

// X64
//------------------------------------------------------------------------------
#if __WINDOWS__
    .X64BaseConfig              = .ToolChain_VS_Windows_X64
                                + .WindowsSDK_X64
                                + .ToolChain_Qt
    .X64DebugConfig             = .X64BaseConfig
                                + .Debug_Config
    .X64ReleaseConfig           = .X64BaseConfig
                                + .Release_Config
    .X64ProfileConfig           = .X64BaseConfig
                                + .Profile_Config
#endif

//------------------------------------------------------------------------------
//
//------------------------------------------------------------------------------
.OutputBase = 'fbuild'

//------------------------------------------------------------------------------
// VisualStudio Project Generation
//------------------------------------------------------------------------------
.ProjectCommon =
[
    .ProjectBuildCommand        = 'cd ^$(SolutionDir) &amp; fbuild -vs -dist -monitor -fastcancel -cache ^$(Configuration)'
    .ProjectRebuildCommand      = 'cd ^$(SolutionDir) &amp; fbuild -vs -dist -monitor -fastcancel -cache -clean ^$(Configuration)'
    .OutputDirectory            = '^$(SolutionDir)\^$(Configuration)'
    .IntermediateDirectory      = '^$(SolutionDir)\^$(Configuration)'
    .BuildLogFile               = '^$(SolutionDir)\^$(Configuration)\^$(ProjectName)-^$(Configuration).log'
    .Platform                   = 'x64'
    .PlatformToolset            = '$VS_PlatformToolset$'
]

.ProjectX64Debug        = [ Using( .ProjectCommon ) .Config = 'Debug' ]
.ProjectX64Profile      = [ Using( .ProjectCommon ) .Config = 'Profile' ]
.ProjectX64Release      = [ Using( .ProjectCommon ) .Config = 'Release' ]

.ProjectConfigs = { .ProjectX64Debug, .ProjectX64Profile, .ProjectX64Release }

// Configurations
//------------------------------------------------------------------------------
#if __WINDOWS__
    .Configs_Windows_MSVC   = { .X64DebugConfig, .X64ProfileConfig, .X64ReleaseConfig }
    .Configs                = .Configs_Windows_MSVC
#endif

.Targets_x64_Debug = {}
.Targets_x64_Profile = {}
.Targets_x64_Release = {}

#include "MyProject.bff"

// Aliases : All-$Platform$-$Config$
//------------------------------------------------------------------------------
ForEach( .Config in .Configs )
{
    Using( .Config )

    Alias( 'All-$Platform$-$Config$' ) { .Targets = .'Targets_$Platform$_$Config$' }
}

// Aliases : All-$Platform$
//------------------------------------------------------------------------------
.Platforms = { 'x64' }
.PlatformConfigs_x64           = { 'Debug', 'Profile', 'Release' }
ForEach( .Platform in .Platforms )
{
    Alias( 'All-$Platform$' )
    {
        .Targets = {}
        ForEach( .Config in .'PlatformConfigs_$Platform$' )
        {
            ^Targets + { 'All-$Platform$-$Config$' }
        }
    }
}

// Aliases : All
//------------------------------------------------------------------------------
#if __WINDOWS__
    Alias( 'All' )
    {
        .Targets        = { 'All-x64' }
    }
#endif

// Visual Studio Solution
//------------------------------------------------------------------------------
#if __WINDOWS__
    VSSolution( 'solution' )
    {
        .SolutionOutput         = 'MyProject.sln'
        .SolutionProjects       = { 'MyProject-proj' }
        .SolutionBuildProject   = 'MyProject-proj'
        .SolutionConfigs        = .ProjectConfigs
    }
#endif

//------------------------------------------------------------------------------
